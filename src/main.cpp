#include <Arduino.h>

// ? Includes de los modulos
#include "global_config.h"
#include "utils.h"
#include "wifi_handler.h"
#include "server_handler_class.h"
#include "routine_class.h"

Scheduler taskHandler;
Routine routine(&taskHandler);
ServerHandler serverHandler(&routine);

void setup() {
    Serial.begin(115200);

    delay(1000);

    initFS();
    initWifi();
    serverHandler.initServer();

    //Pritty print for Serial console
    Serial.print("\n\n                      ............                      \n                ........................                \n             ..............................             \n          ............::::.:::::::............          \n        .........:=**%  :=-=-=+*- .....:........        \n      ..........=*:.+% =#*%*===+@=   .-:..........      \n     ...........+++=%::.  .:==#%#.     :...........     \n    .............:#-   .... .. .*@-    .:............   \n   ...............:  ..+%@%*: .: :%*     ::......:....  \n  ...............:.  :-@@@@@@= .   *#      ....:=.....  \n ..............:.   :..%@@@@@=  :   **       .::....... \n ............::     .   :==-..:. -   #:   --:.......... \n............:.      .:=+*##%%@% .@@+:-@@#=--............\n...........:.   .::#@@@@@@@@@@@+@@@@@@@@*-..............\n..........:. :::...:%@@@@@@@@@@@%%@*=---=:..............\n.........:-::.......:@@**@@@@@.   -.....................\n ........::.............#@%%%@##%@-.................... \n .................::=:.:#@%%%@%%%@-.................... \n  ............:---:*@@:.-%@@#:::...==-................  \n  ...........:-:::#@@%%@%%%%=    -#-::==-:............  \n   .......=++-:::#%@%%%%%%%@= .=%%-::::::==::........   \n     ...-+%+::::*==#%%%%@%+:+#@@%-::::::-+++++++=..     \n      :=++#::::#. %=+%#+--*%*==%-::::::-+++++**+*.      \n       :+*::::*.  .%%=+++:   :#-:::::::++++*#+++-       \n         .:::*:  =*+:+%.    -#::::::::***+#*+=:         \n            -= =-.+ .--@-  =*::::::::*@@%@*-.           \n              . +%=.:@+.=-++::::::::-@@#=:      |Powered by: MajorCrayon7047            \n                   : -*#+**::::::.....          |Proyect Name: Controlador de Riego\n");
}

void loop(){
    wifiKeepAlive();
    serverHandler.handleClient();
    routine.executeTaskHandler();
    routine.autoRoutineHandler();
}